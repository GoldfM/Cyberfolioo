{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/normalize.css' %}">
    <link rel="stylesheet" href="{% static 'css/general_styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/project_page_styles.css' %}">
    <link href = "{% static 'fonts/stylesheet.css' %}" rel = "stylesheet" type = "text/css" />
{% endblock %}

{% block content %}
    <main style="display: inline;">
        <div class="hero">
            <div class="hero_info">
                <h1 class="hero_title">{{proj.name}}</h1>
                <h2>Основные мысли</h2>
                <p class="hero-description">{{proj.key_words}}</p>
                <h2 class="hero-review_title">Оценка проекта</h2>
                <div class="hero_review">
                    <div class="hero-review_item">
                        <div class="hero_review_stars hero-review_description">
                            <span class="hero-review_item-review">
                                <div id="reserved_rating" data-value="0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="reserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="reserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="reserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="reserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="reserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                </div>
                                <input type="hidden" class="already" value="{{proj.get_rate_registred}}">
                                {{proj.get_rate_registred}} (Зарегистрированными пользователями)
                                <script type="text/javascript">
                                    var newScore = document.querySelector('.already');
                                    var rating = document.querySelector('#reserved_rating');
                                    newScore.value = Math.trunc(parseFloat(newScore.value.replace(',','.').replace(' ','')))
                                    rating.dataset.value = newScore.value;
                                    var reserved = document.querySelectorAll('.reserved_star')
                                    for (var i = 0; i < rating.dataset.value; ++i){
                                        reserved[i].classList.add('active')
                                    }
                                </script>
                            </span>
                        </div>
                    </div>
                    <div class="hero-review_item">
                        <div class="hero_review_stars hero-review_description">
                            <span class="hero-review_item-review">
                                <div id="unreserved_rating" data-value="1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="unreserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="unreserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="unreserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="unreserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                                        <path class="unreserved_star" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                                    </svg>
                                </div>
                                <input type="hidden" class="non-already" value="{{proj.get_rate_unregistred}}">
                                {{proj.get_rate_unregistred}} (Незарегистрированными пользователями)
                                <script type="text/javascript">
                                    var newUnScore = document.querySelector('.non-already');
                                    var unreserved_rating = document.querySelector('#unreserved_rating');
                                    newUnScore.value = Math.trunc(parseFloat(newUnScore.value.replace(',','.').replace(' ','')))
                                    unreserved_rating.dataset.value = newUnScore.value;
                                    var unreserved = document.querySelectorAll('.unreserved_star')
                                    for (var i = 0; i < unreserved_rating.dataset.value; ++i){
                                        unreserved[i].classList.add('active')
                                    }
                                    console.log(unreserved);
                                </script>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="hero_img">
                {% if proj.avatar_image %}
                    <img class="hero_pic" src="{{proj.avatar_image.url}}">
                {% endif %}
            </div>
        </div>

        <div class="main_container">
            <div class="description">
                <div>
                    <h1 class="description_title">Описание</h1>
                    <p class="description_text">{{proj.descriptions}}</p>
                </div>
                <div class="link_container">
                    <div class="link_container_left-part">
                        Ссылка на скачивание
                    </div>
                    <div class="link_container_right-part">
                        <a class="description_link" href="{{proj.url}}">{{proj.url}}</a>
                    </div>
                </div>
            </div>
            <div class="about-project">
                <h1 class="about-project_title">О проекте</h1>
                <div class="about-project_category_section">
                    <div class="about-project_category">
                        <div class="about-project_category_header">Специализация</div>
                        <div class="about-project_category_description">{{proj.spec_proj}}</div>
                    </div>
                    <div class="about-project_category">
                        <div class="about-project_category_header">Срок разработки</div>
                        <div class="about-project_category_description">{{proj.time_developing}}</div>
                    </div>
                    <div class="about-project_category">
                        <div class="about-project_category_header">Тип проекта</div>
                        <div class="about-project_category_description">{{proj.type}}</div>
                    </div>
                    <div class="about-project_category">
                        <div class="about-project_category_header">Состав участников</div>
                        <div class="about-project_category_description">
                        {% for teammate in proj.teammates %}
                            {% if teammate %}
                                <a href="{{ teammate }}" class="about-project_category_description_user" >{{teammate}}</a>
                            {% endif %}
                        {% endfor %}
                        </div>
                    </div>
                </div>
                {% if request.user in proj.get_users %}
                <div class="about-project_edit">
                    <a href="{% url 'editProject' slug=proj.slug%}">
                    <div>
                        <img class="about-project_img" src="{% static 'images/pen.png' %}">
                    </div>
                    <div>Редактировать</div>
                    </a>
                    <form action="{% url 'deleteProject' %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="project_id" value="{{ proj.id }}">
                        <input type="hidden" name="user_id" value="{{ request.user.id }}">
                        <button type="submit" class="basket-icon"><img src="{% static 'images/basket.png' %}"></button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
        {% if request.user not in proj.get_users and request.user.id not in proj.get_users_who_rated %}
        <div class="review">
            <div class="review_item">
                <h1 class="review-title">Оценить проект</h1>
                    <div class="rating" data-value="0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                            <path class="star" data-value="1" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                            <path class="star" data-value="2" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                            <path class="star" data-value="3" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                            <path class="star" data-value="4" d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="3.07vw" height="2.96vw" viewBox="0 0 59 57" fill="none">
                            <path class="star" data-value="5"  d="M26.6467 2.78096C27.5448 0.0170212 31.455 0.0170281 32.3531 2.78096L37.2456 17.8387C37.6473 19.0748 38.7991 19.9117 40.0988 19.9117H55.9315C58.8376 19.9117 60.046 23.6305 57.6948 25.3387L44.8859 34.6449C43.8345 35.4089 43.3945 36.763 43.7961 37.999L48.6887 53.0568C49.5867 55.8207 46.4233 58.1191 44.0722 56.4109L31.2633 47.1047C30.2118 46.3407 28.788 46.3407 27.7365 47.1047L14.9276 56.4109C12.5765 58.1191 9.41311 55.8207 10.3111 53.0568L15.2037 37.999C15.6053 36.763 15.1653 35.4089 14.1139 34.6449L1.30501 25.3387C-1.04613 23.6305 0.162206 19.9117 3.06837 19.9117H18.901C20.2007 19.9117 21.3525 19.0748 21.7542 17.8387L26.6467 2.78096Z" fill="#FF9000"/>
                        </svg>
                    </div>
                    <script type="text/javascript">
                        var temp = document.querySelector('.rating')
                        var stars = document.querySelectorAll('.star')
                        document.addEventListener("click", function (e) {
                            var index = e.target.dataset.value;
                            console.log(index);
                            if (index !== undefined)
                            {
                                for (var i = 0; i < 5; ++i){
                                    stars[i].classList.remove('active')
                                }
                                for (var i = 0; i < index; ++i){
                                    stars[i].classList.add('active')
                                }
                            }
                            temp.dataset.value = index;
                        });
                    </script>
                <form action="{% url 'rateProject' %}" method="post">
                {% csrf_token %}
                <input id="formforkatya" type="hidden" name="score" value="0">
                <input type="hidden" name="user_id" value="{{ request.user.id }}">
                <input type="hidden" name="project_id" value="{{ proj.id }}">
                <input type="hidden" name="redirect_url" value="{{ request.get_full_path }}">
                <button onclick="setValue();" type="submit" class="review_button">Поставить оценку</button>
                <script>
                    function setValue() {
                      var form = document.getElementById("formforkatya");
                      var need = document.querySelector('.rating');
                      form.value = need.dataset.value;
                      console.log(form.value)
                    }
                </script>
                </form>
            </div>
            <div class="review_item">
                <img src="{% static 'images/review_img.png' %}">
            </div>
        </div>
    {% endif %}
    </main>
{% endblock %}